<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Фильтр объявлений — Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 18px; max-width: 720px; margin: 0 auto; background:#f7f7fb; color:#111;}
    .card { background:white; border-radius:12px; box-shadow:0 6px 20px rgba(20,20,30,0.06); padding:18px; margin-top:24px;}
    label {display:block; margin:10px 0 4px; font-weight:600; font-size:14px;}
    input, select {width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6e6ef; font-size:14px; box-sizing:border-box;}
    .row {display:flex; gap:10px;}
    .row > * {flex:1;}
    .actions {display:flex; gap:10px; margin-top:14px;}
    button {padding:10px 14px; border-radius:10px; border:0; font-weight:600; cursor:pointer;}
    .btn-primary {background:#0064ff; color:white;}
    .btn-ghost {background:transparent; border:1px solid #dfe7ff;}
    small.note {color:#666;display:block;margin-top:10px;}
  </style>
</head>
<body>
  <h2>Фильтр объявлений</h2>
  <div class="card">
    <label>Категория</label>
    <select id="category">
      <option value="авто">Авто</option>
      <option value="недвижимость">Недвижимость</option>
      <option value="электроника">Электроника</option>
      <option value="услуги">Услуги</option>
    </select>

    <div class="row" style="margin-top:10px;">
      <div>
        <label>Цена мин</label>
        <input id="price_min" type="number" placeholder="0">
      </div>
      <div>
        <label>Цена макс</label>
        <input id="price_max" type="number" placeholder="100000">
      </div>
    </div>

    <label style="margin-top:8px;">Ключевые слова</label>
    <input id="keywords" placeholder="например: iPhone, ремонт, сад">

    <label style="margin-top:8px;">Город (необязательно)</label>
    <input id="city" placeholder="Москва">

    <div class="actions">
      <button id="apply" class="btn-primary">Применить</button>
      <button id="reset" class="btn-ghost">Сбросить</button>
    </div>

    <small class="note">Кнопка "Применить" отправит JSON в бота через Telegram WebApp API и свернёт мини‑приложение.</small>
  </div>

  <script>
    // Поддержка запуска в обычном браузере (для локальной проверки)
    if (!window.Telegram || !window.Telegram.WebApp) {
      console.warn("Telegram WebApp API не обнаружен — включён мок для локального тестирования.");
      window.Telegram = {
        WebApp: {
          initData: null,
          isExpanded: false,
          expand() { this.isExpanded = true; console.log("mock expand"); },
          close() { console.log("mock close"); },
          sendData(data) { console.log("mock sendData:", data); alert("Mock sendData:\n" + data); },
          MainButton: { show() {}, hide() {} }
        }
      };
    }

    const tg = window.Telegram.WebApp;
    try { tg.expand(); } catch(e){}

    document.getElementById("apply").addEventListener("click", () => {
      const data = {
        category: document.getElementById("category").value,
        price_min: document.getElementById("price_min").value || null,
        price_max: document.getElementById("price_max").value || null,
        keywords: document.getElementById("keywords").value.trim(),
        city: document.getElementById("city").value.trim(),
        ts: new Date().toISOString()
      };
      const payload = JSON.stringify(data);
      // Отправляем данные в бота
      try {
        tg.sendData(payload);
      } catch (err) {
        console.error("sendData failed:", err);
        alert("Ошибка отправки данных в Telegram: " + err);
      }
      // Закрываем (сворачиваем) мини-приложение
      try { tg.close(); } catch(e) {}
    });

    document.getElementById("reset").addEventListener("click", () => {
      document.getElementById("category").selectedIndex = 0;
      document.getElementById("price_min").value = "";
      document.getElementById("price_max").value = "";
      document.getElementById("keywords").value = "";
      document.getElementById("city").value = "";
    });
  </script>
</body>
</html>

